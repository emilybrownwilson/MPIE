[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MPIE CODE FROM LECTURES",
    "section": "",
    "text": "R code:\n\ninstall.packages(\"readstata13\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"survey\")\ninstall.packages(\"freqtables\")\n\n\n\n\nStata code:\n\ndes m3*\n  \nta m3a\nta m3b\nta m3c\n\nR code:\n\nlibrary(tidyverse)\ntable(data$m3a)\nprop.table(table(data$m3a))\ntable(data$m3b)\nprop.table(table(data$m3b))\ntable(data$m3c)\nprop.table(table(data$m3c))\n\n\n\n\nStata code:\n\ngen sba=0\nreplace sba=1 if m3a==1 | m3b==1 | m3c==1\nreplace sba=. if m3a==9\n\nR code:\n\ndata$sba &lt;- 0\ndata$sba[data$m3a==1 | data$m3b==1 | data$m3c==1] &lt;- 1\ndata$sba[data$m3a==9] &lt;- NA\n\n\n\n\nStata code:\n\nta sba m3a, mi\n\nR code:\n\ntable(data$sba, data$m3a, exclude=NULL)\n\n\n\n\nStata code:\n\nla var sba\nla def yn 1\"Yes\" 0\"No\"\nla val sba yn\nta sba\n\nR code:\n\ndata$sba[data$sba==0] &lt;- \"No\"\ndata$sba[data$sba==1] &lt;- \"Yes\"\nprop.table(table(data$sba))\n\n\n\n\n\n\n\nStata code:\n\ngen nwgt = v005/1000000\nsvyset v001 [pweight=nwgt], strata(v023) singleunit(centered)\n\nR code:\n\nlibrary(survey)\ndata$wt &lt;- data$v005/1000000\ndata &lt;- data %&gt;% filter(v023!=60) # Only 1 PSU in this cluster which is problem for svyby\nsvydata &lt;- svydesign(id=~v001,strata=~v023, data=data, weights=~wt,nest=TRUE,survey.lonely.psu = \"adjust\")\n\n\n\n\nStata code:\n\ntab v106\nsvy:tab v106\nsvy: prop sba\nprop sba\n\nsvy: prop sba\nestat effects\n\nR code:\n\nprop.table(table(data$v106))\nprop.table(svytable(~ v106, svydata) )\n\nsvyby(~sba, ~v000,  svydata, svymean, na.rm=TRUE)\n\nlibrary(freqtables)\ndata %&gt;% filter(!is.na(sba)) %&gt;% freq_table(sba)\n\nsvyby(~sba, ~v000,  svydata, svymean, na.rm=TRUE, deff=\"replace\")"
  },
  {
    "objectID": "index.html#generating-coverage-indicators-from-survey-data",
    "href": "index.html#generating-coverage-indicators-from-survey-data",
    "title": "MPIE CODE FROM LECTURES",
    "section": "",
    "text": "R code:\n\ninstall.packages(\"readstata13\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"survey\")\ninstall.packages(\"freqtables\")\n\n\n\n\nStata code:\n\ndes m3*\n  \nta m3a\nta m3b\nta m3c\n\nR code:\n\nlibrary(tidyverse)\ntable(data$m3a)\nprop.table(table(data$m3a))\ntable(data$m3b)\nprop.table(table(data$m3b))\ntable(data$m3c)\nprop.table(table(data$m3c))\n\n\n\n\nStata code:\n\ngen sba=0\nreplace sba=1 if m3a==1 | m3b==1 | m3c==1\nreplace sba=. if m3a==9\n\nR code:\n\ndata$sba &lt;- 0\ndata$sba[data$m3a==1 | data$m3b==1 | data$m3c==1] &lt;- 1\ndata$sba[data$m3a==9] &lt;- NA\n\n\n\n\nStata code:\n\nta sba m3a, mi\n\nR code:\n\ntable(data$sba, data$m3a, exclude=NULL)\n\n\n\n\nStata code:\n\nla var sba\nla def yn 1\"Yes\" 0\"No\"\nla val sba yn\nta sba\n\nR code:\n\ndata$sba[data$sba==0] &lt;- \"No\"\ndata$sba[data$sba==1] &lt;- \"Yes\"\nprop.table(table(data$sba))"
  },
  {
    "objectID": "index.html#design-based-analysis-of-survey-data",
    "href": "index.html#design-based-analysis-of-survey-data",
    "title": "MPIE CODE FROM LECTURES",
    "section": "",
    "text": "Stata code:\n\ngen nwgt = v005/1000000\nsvyset v001 [pweight=nwgt], strata(v023) singleunit(centered)\n\nR code:\n\nlibrary(survey)\ndata$wt &lt;- data$v005/1000000\ndata &lt;- data %&gt;% filter(v023!=60) # Only 1 PSU in this cluster which is problem for svyby\nsvydata &lt;- svydesign(id=~v001,strata=~v023, data=data, weights=~wt,nest=TRUE,survey.lonely.psu = \"adjust\")\n\n\n\n\nStata code:\n\ntab v106\nsvy:tab v106\nsvy: prop sba\nprop sba\n\nsvy: prop sba\nestat effects\n\nR code:\n\nprop.table(table(data$v106))\nprop.table(svytable(~ v106, svydata) )\n\nsvyby(~sba, ~v000,  svydata, svymean, na.rm=TRUE)\n\nlibrary(freqtables)\ndata %&gt;% filter(!is.na(sba)) %&gt;% freq_table(sba)\n\nsvyby(~sba, ~v000,  svydata, svymean, na.rm=TRUE, deff=\"replace\")"
  },
  {
    "objectID": "index.html#assessing-change-in-intervention-coverage---option-1",
    "href": "index.html#assessing-change-in-intervention-coverage---option-1",
    "title": "MPIE CODE FROM LECTURES",
    "section": "Assessing Change in Intervention Coverage - Option 1",
    "text": "Assessing Change in Intervention Coverage - Option 1\n\nChange directory to where your data are stored\n\n\nUse the child recodes from Nigeriaâ€™s 2008 and 2013 DHS in Stata or R\nR users may need to install/load these libraries\n\ninstall.packages(\"dplyr\")\ninstall.packages(\"tidyr\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"survey\")\ninstall.packages(\"haven\")\ninstall.packages(\"labelled\")\ninstall.packages(\"knitr\")\ninstall.packages(\"multcomp\")\n\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(tidyverse)\nlibrary(survey)\nlibrary(haven)\nlibrary(labelled)\nlibrary(knitr)\nlibrary(multcomp)\n\n\n\nStep 1: Create coverage indicators (in both datasets)\nStata code:\n\nuse DHS_Nigeria2008_kids.dta, clear\nnumlabel, add\n\ndes v005 h11 h13 h31 h31b h32z v024\n\n* Svy set the data\n    gen wgt = v005/1000000\n    sum wgt \n    gen nwgt=wgt/r(mean)\n    sum nwgt\n    \n    svyset v001 [pw=nwgt], strata(v023) singleunit(centered)    \n    \n* Create diarrhea variable\n    tab h11\n    gen diarrhea=0 if h11==0\n    replace diarrhea=1 if h11==2\n    replace diarrhea=0 if h11==8|h11==9\n    svy: ta diarrhea\n\n* Create ORS treatment\n    tab h13\n    gen ors=0 if diarrhea==1\n    replace ors=1 if h13==2\n    svy: tab ors\n\nR code:\n\n#******** REMEMBER TO REPLACE TO YOUR DIRECTORY ********#\n\n# Household DHS 2008\nhh_2008 &lt;- read_dta(\"...DHS_Nigeria2008_HH.dta\")\n#dict_hh08 &lt;- generate_dictionary(hh_2008) # Creates a data dictionary\ngc() # Clear memory\n\n# Kids DHS 2008\nkids_2008 &lt;- read_dta(\"...DHS_Nigeria2008_kids.dta\")\n\n# Household DHS 2013\nhh_2013 &lt;-  read_dta(\"...DHS_Nigeria2013_HH.dta\")\n\n# Kids DHS 2013\nkids_2013 &lt;-  read_dta(\"...DHS_Nigeria2013_kids.dta\")\n\n\nkids_2008_des &lt;- kids_2008[,c(\"v005\",\"h11\",\"h13\",\"h31\",\"h31b\",\"h32z\",\"v024\")]\nstr(kids_2008_des)\n\nkids_2008 &lt;- kids_2008 %&gt;%\n  mutate(diarrhea = case_when(h11 == 0 ~ 0,\n                              h11 == 2 ~ 1,\n                              h11 == 8 | h11 == 9 ~ 0))\nkids_2008 &lt;- kids_2008 %&gt;%\n  mutate(ors = case_when(diarrhea == 1 & h13 == 2 ~ 1,\n                         diarrhea == 1 & !h13 == 2 ~ 0))\n\nkids_2008$wgt &lt;- kids_2008$v005/1000000 # Correct weighting\nkids_2008$nwgt &lt;- kids_2008$wgt/mean(kids_2008$wgt) # Create normalized weighting\n\n# Svy set the data\n  svyset_2008 &lt;- svydesign(\n  id = ~ v001, # Variable which represents the cluster\n  data = kids_2008, # The name of your data that you are using\n  weight = ~ nwgt, # Here we use normalized weighting\n  strata = ~ v023, # Variable which represents the stratum\n  nest = TRUE, # relabel cluster ids to enforce nesting within strata\n  survey.lonely.psu = \"adjust\") # Single unit centered on STATA\n  \n  options(survey.lonely.psu=\"adjust\")\n  \nkable(prop.table(svytable(~ors, design = svyset_2008))*100)  \n\n\n\nStep 2a: Prepare 2008 and 2013 datasets to be combined\nStata code:\n\n***2008 DHS\n* keep variables of interest\n    keep caseid midx v001 v002 v003 v005 v012 v022 v024 v025 v106 v190 v116 v023 diarrhea ors nwgt\n    save nigeria2008, replace\n\n* Call household dataset to obtain household size\n    use DHS_Nigeria2008_HH, clear\n    keep  hvidx  hv012 hv001 hv002 \n    rename hv001 v001\n    rename hvidx v003\n    rename hv002 v002\n    sort v001 v002 v003\n    save nigeria2008HH, replace\n\n* Merge both datasets\n    use nigeria2008, clear\n    sort v001 v002 v003\n    merge m:1 v001 v002 v003 using nigeria2008HH\n    keep if _merge==3\n    drop _merge\n\n    save nigeria2008anal, replace\n    \n***2013 Nigeria dataset\n    use DHS_Nigeria2013_kids.dta, clear  \n\n* Svy set the data\n    gen wgt = v005/1000000\n    sum wgt \n    gen nwgt=wgt/r(mean)\n    sum nwgt\n    \n    svyset v001 [pw=nwgt], strata(v023) singleunit(centered)    \n\n* Create diarrhea variable\n    gen diarrhea=0 if h11==0\n    replace diarrhea=1 if h11==2\n    replace diarrhea=0 if h11==8|h11==9\n\n* Create ORS treatment\n    gen ors=0 if diarrhea==1\n    replace ors=1 if h13==2\n\n* keep variables of interest\n    keep caseid midx v001 v002 v003 v005 v012 v022 v024 v025 v106 v190 v116 v023 diarrhea ors nwgt\n        save nigeria2013, replace\n\n* Call household dataset to obtain household size\n    use DHS_Nigeria2013_HH, clear\n    keep  hvidx  hv012 hv001 hv002 \n    rename hv001 v001\n    rename hvidx v003\n    rename hv002 v002\n    sort v001 v002 v003\n    save nigeria2013HH, replace\n\n* Merge both datasets\n    use nigeria2013, clear\n    sort v001 v002 v003\n    merge m:1 v001 v002 v003 using nigeria2013HH\n    keep if _merge==3\n\n    drop _merge\n    gen survey=1\n    save nigeria2013anal, replace   \n\nR code:\n\n# Select only the variables of interest\nkids_2008 &lt;- kids_2008[,c(\"caseid\", \"midx\", \"v001\", \"v002\", \"v003\", \"v005\", \"v012\", \"v022\", \"v024\", \"v025\", \"v106\", \"v190\", \"v116\", \"v023\", \"diarrhea\", \"ors\", \"nwgt\")]\n\n# Get the household size from this dataset\nhh_2008 &lt;- hh_2008 %&gt;%\n  rename(v001 = hv001,\n         v002 = hv002,\n         v003 = hvidx)\n\n# Join household size data to the kids dataset\nkids_2008 &lt;- kids_2008 %&gt;%\n  left_join(hh_2008, by = c(\"v001\", \"v002\", \"v003\"))\n\n\n########## Repeat indicator creation for 2013\nkids_2013 &lt;- kids_2013 %&gt;%\n  mutate(diarrhea = case_when(h11 == 0 ~ 0,\n                              h11 == 2 ~ 1,\n                              h11 == 8 | h11 == 9 ~ 0))\nkids_2013 &lt;- kids_2013 %&gt;%\n  mutate(ors = case_when(diarrhea == 1 & h13 == 2 ~ 1,\n                         diarrhea == 1 & !h13 == 2 ~ 0))\n\nkids_2013$wgt &lt;- kids_2013$v005/1000000 # Correct weighting\nkids_2013$nwgt &lt;- kids_2013$wgt/mean(kids_2013$wgt) # Create normalized weighting\n\n# Svy set the data\n  svyset_2013 &lt;- svydesign(\n  id = ~ v001, # Variable which represents the cluster\n  data = kids_2013, # The name of your data that you are using\n  weight = ~ nwgt, # Here we use normalized weighting\n  strata = ~ v023, # Variable which represents the stratum\n  nest = TRUE, # relabel cluster ids to enforce nesting within strata\n  survey.lonely.psu = \"adjust\") # Single unit centered on STATA\n  \n  options(survey.lonely.psu=\"adjust\")\n  \nkable(prop.table(svytable(~ors, design = svyset_2013))*100)  \n\nkids_2013$wgt &lt;- kids_2013$v005/1000000 # Correct weighting\nkids_2013$nwgt &lt;- kids_2013$wgt/mean(kids_2013$wgt) # Create normalized weighting\n\nsvyset_2013 &lt;- svydesign(\n    id = ~ v001, # Variable which represents the cluster\n    data = kids_2013, # The name of your data that you are using\n    weight = ~ nwgt, # Here we use normalized weighting\n    strata = ~ v023, # Variable which represents the stratum\n    nest = TRUE, # relabel cluster ids to enforce nesting within strata\n    survey.lonely.psu = \"adjust\") # Single unit centered on STATA\n  \n  options(survey.lonely.psu=\"adjust\")\n  \nkable(prop.table(svytable(~ors, design = svyset_2013))*100)\n\n# Select only the variables of interest\nkids_2013 &lt;- kids_2013[,c(\"caseid\", \"midx\", \"v001\", \"v002\", \"v003\", \"v005\", \"v012\", \"v022\", \"v024\", \"v025\", \"v106\", \"v190\", \"v116\", \"v023\", \"diarrhea\", \"ors\", \"nwgt\")]\n\n# Get the household size from this dataset\nhh_2013 &lt;- hh_2013 %&gt;%\n  rename(v001 = hv001,\n         v002 = hv002,\n         v003 = hvidx)\n\n# Join household size data to the kids dataset\nkids_2013 &lt;- kids_2013 %&gt;%\n  left_join(hh_2013, by = c(\"v001\", \"v002\", \"v003\"))\n\n\n\nStep 2b: Append datasets (Stata) / rbind datasets (R)\nStata code:\n\n* Append datasets\n    use nigeria2008anal, clear\n    gen survey=0\n    append using nigeria2013anal\n    save nigeria2008_2013, replace\n\nR code:\n\nkids_2008$survey &lt;- 0 # Indicates BASELINE\nkids_2013$survey &lt;- 1 # Indicates ENDLINE\n\nkids_2008$survey_label &lt;- \"DHS 2008\" # Indicates BASELINE\nkids_2013$survey_label &lt;- \"DHS 2013\" # Indicates ENDLINE\n\nval_labels(kids_2008) &lt;- NULL # Labels need to removed from the dataset for row binding to happen or else ERROR\nval_labels(kids_2013) &lt;- NULL\nmerged &lt;- rbind(kids_2008, kids_2013) # Merge the two datasets together\n\n\n\nStep 3: set svy for pooled dataset\nStata code:\n\nuse nigeria2008_2013, clear\negen stratum = group(v023 survey)\nsvyset v001 [pw=nwgt], strata(stratum) singleunit(centered)\nsvy: prop ors, over(survey)\nsvy: prop ors, over(survey) coeflegend\n\nR code:\n\n# Need to establish need stratum for each survey because currently they are overlapped (i.e. same stratum value across both surveys)\n\nmerged$cluster &lt;- paste0(merged$survey,\"_\",merged$v001)\nmerged$stratum &lt;- paste0(merged$survey,\"_\",merged$v023)\n\n  svyset_merge &lt;- svydesign(\n    id = ~ cluster, # Variable which represents the cluster\n    data = merged, # The name of your data that you are using\n    weight = ~ nwgt, # Here we use normalized weighting\n    strata = ~ factor(stratum), # Variable which represents the stratum\n    nest = TRUE, # relabel cluster ids to enforce nesting within strata\n    survey.lonely.psu = \"adjust\") # Single unit centered on STATA\n\noptions(survey.lonely.psu=\"adjust\")\n  \nkable(svyby(~I(ors == 0), ~survey_label, design = svyset_merge, svyciprop, vartype=\"ci\", method = \"logit\"))\nkable(svyby(~I(ors == 1), ~survey_label, design = svyset_merge, svyciprop, vartype=\"ci\", method = \"logit\"))\n\nors_merged &lt;- svyby(~ors, ~survey_label, svyset_merge, svyciprop, na.rm = TRUE, vartype = \"se\", method = \"logit\")\nors_merged\n100*confint(ors_merged)\n\nors_diff &lt;- svycontrast(ors_merged, quote(`DHS 2013` - `DHS 2008`)) # Standard error is needed to calculate the difference\nors_diff*100\nconfint(ors_diff)*100 # SE and CI are slightly different to STATA output"
  },
  {
    "objectID": "index.html#assessing-change-in-intervention-coverage---option-2",
    "href": "index.html#assessing-change-in-intervention-coverage---option-2",
    "title": "MPIE CODE FROM LECTURES",
    "section": "Assessing Change in Intervention Coverage - Option 2",
    "text": "Assessing Change in Intervention Coverage - Option 2\n\nStep 4: Run the logit model of the output variable on time\nStata code:\n\n* Assess changes between 2008 and 2013\n    svy: logit ors survey, or\n\nR code:\n\nors.glm &lt;- svyglm(ors ~ survey, family = quasibinomial, design = svyset_merge, na.action = na.omit)\nkable(data.frame(OR = exp(coef(ors.glm)), ci = exp(confint(ors.glm)))) #create a table of results to include odds ratio + CI\n\n\n\nStep 5: Control for other variables\nStata code:\n\n* toilet\n    numlabel, add\n    tab v116\n    tab v116, nol\n    recode v116 11/15=1 21/23=2 31=3 41/99=4, gen(toilet)\n    lab def toilet 1 \"flush\" 2\"latrine\" 3\"no facility\" 4\"Other\"\n    lab val toilet toilet\n\n* Urban/rural   \n    tab v025\n    gen rural=v025==2\n    tab rural\n\nxi: svy: logit ors survey i.v106 i.v190 hv012 i.toilet rural, or\n\nsvy: logit ors survey, or\n\nR code:\n\nmerged &lt;- merged %&gt;%\n  mutate(toilet = case_when(v116 &gt;= 11 & v116 &lt;= 15 ~ \"flush\",\n                            v116 &gt;= 21 & v116 &lt;= 23 ~ \"latrine\",\n                            v116 == 31 ~ \"no facility\",\n                            v116 == 41 | v116 == 99 ~ \"Other\"),\n         rural = case_when(v025 == 1 ~ 0,\n                           v025 == 2 ~ 1))\n\n  svyset_merge &lt;- svydesign(\n    id = ~ cluster, # Variable which represents the unique id\n    data = merged, # The name of your data that you are using\n    weight = ~ nwgt, # Here we use normalized weighting\n    strata = ~ factor(stratum), # Variable which represents the stratum\n    nest = TRUE, # relabel cluster ids to enforce nesting within strata\n    survey.lonely.psu = \"adjust\") # Single unit centered on STATA\n\nors.adjust.glm &lt;- svyglm(ors ~ survey_label + as.factor(v106) + as.factor(v190) + hv012 + toilet + rural, family = quasibinomial, design = svyset_merge, na.action = na.omit)\nkable(data.frame(OR = exp(coef(ors.adjust.glm)), ci = exp(confint(ors.adjust.glm)))) #create a table of results to include odds ratio + CI"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site"
  }
]