---
title: "MPIE Lecture 7: Analyzing survey data"
---

## Generating Coverage Indicators from Survey Data

## Load data

### Step 5: explore variables 
Stata code:
```{r, eval=FALSE}
des m3*
  
ta m3a
ta m3b
ta m3c
```

R code:
```{r, eval=FALSE}
library(tidyverse)
data <- data %>% select(starts_with("m3"))
str(data)

table(data$m3a)
prop.table(table(data$m3a))
table(data$m3b)
prop.table(table(data$m3b))
table(data$m3c)
prop.table(table(data$m3c))
```



### Step 6: create SBA variable

Stata code:
```{r, eval=FALSE}
gen sba=0
replace sba=1 if m3a==1 | m3b==1 | m3c==1
replace sba=. if m3a==9
```

R code:
```{r, eval=FALSE}
data <- NGKR6AFL
data$sba <- 0
data$sba[data$m3a==1 | data$m3b==1 | data$m3c==1] <- 1
data$sba[data$m3a==9] <- NA
```

### Step 7: check SBA variable


### Step 8: label Variable


## Design-based Analysis of Survey Data

### Step 3: svyset your data

Stata code:
```{r, eval=FALSE}
gen nwgt = v005/1000000
svyset v001 [pweight=nwgt], strata(v023) singleunit(centered)
```

### Step 4: Look at unweighted versus weighted proportions & run estimation

Stata code:
```{r, eval=FALSE}
tab v106
svy:tab v106

svy: prop sba
prop sba

svy: prop sba 
estat effects
```


### Estimating coverage in a subgroup

Stata code:
```{r, eval=FALSE}
ta v149
svy, subpop(v149): prop sba
svy: prop sba if v149==0
```



